<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
    		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    		<meta name="viewport" content="width=device-width,initial-scale=1.0" />
		<title>幼儿安全健康管理</title>
		<link href="css/main.css" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<div id="nav" class="nav">
			<header class="header">
				<span>健康伴小宝后台管理平台</span>
				<span class="right">
					欢迎光临<a class="nickname" data-bind="text: user.name"></a>!&nbsp;&nbsp;&nbsp;<a class="link" id="logout">退出登录</a>
				</span>
				<div class="clear"></div>
			</header>
			<nav id="topNav" class="top-nav">
				<ul class="top-nav-menu">
					<!-- ko foreach: menus -->
					<li class="top-nav-menu-item" data-bind="attr: { index: $index }, css: { selected: $index() == 0  }">
						<a class="top-nav-menu-nav">
							<img class="top-nav-menu-img" data-bind="attr: { src: icon }"/>
							<p class="top-nav-menu-text" data-bind="text: name">用户管理</p>
						</a>
					</li>
					<!-- /ko -->
					<li class="clear"></li>
				</ul>
				<ul class="top-sub-menu">
					<!-- ko foreach: submenus -->
					<li class="top-sub-menu-item" data-bind="attr: { index: $index, vpath: __path }, css: { selected: $index() == 0  }">
						<a class="top-sub-menu-nav" data-bind="text: name"></a>
					</li>
					<!-- /ko -->
					<li class="clear"></li>
				</ul>
			</nav>
			
			<div class="breadcrumb">
				<span class="title" data-bind="text: title">系统用户列表</span>
				<div class="crumbs" data-bind="foreach: crumbs">
					<!-- ko if: $index() > 0 -->
					<span class="split">/</span>
					<!-- /ko -->
					<a class="bread" data-bind="text: name">/</a>
				</div>
			</div>
		</div>
		<div id="router-view" class="content"></div>
		<script type="text/javascript" src="lib/jquery/jquery-3.1.1.min.js"></script>
		<script type="text/javascript" src="js/jquery.cookie.js"></script>
		<script type="text/javascript" src="lib/md5/md5.min.js"></script>
		<script type="text/javascript" src="lib/moment/moment.min.js"></script>
		<script type="text/javascript" src="lib/ko/knockout-3.4.1.js"></script>
	    <script type="text/javascript" src="lib/layer/layer.js"></script>
	    <script type="text/javascript" src="js/config.js"></script>
	    <script type="text/javascript" src="js/app.js"></script>
	    <script type="text/javascript" src="js/router.js"></script>
	    <script type="text/javascript" src="js/mvc.js"></script>
	    <script type="text/javascript" src="js/table.js"></script>
	    <script type="text/javascript" src="js/pager.js"></script>
	    <script type="text/javascript" src="router.config.js"></script>
	    
	    <script>
	    		(function(w){
	    			var router = new Router("#router-view", getRoutes());
	    			new Mvc(router);
	    			router.replace("/user/system");
	    			w.$router = router;
	    		})(window);
	    </script>
	    
	    <script type="text/javascript">
	    		(function(w, $, ko, app) {
	    			var user = app.getUser();
				
				var routes = w.$router.routes;
				
				var menus = [];
				var menu = null;
				for(var i = 0, ilen = routes.length; i < ilen; i++) {
					if(routes[i].hidden !== true) {
						menu = routes[i];
						menu.menus = [];
						menus.push(routes[i]);
						
						if(menu.children) {
							for(var j = 0, jlen = menu.children.length; j < jlen; j++) {
								if(menu.children[j].hidden !== true) {
									menu.menus.push(menu.children[j]);
								}
							}
						}
					}
				}
				
	    			var vm = {
	    				title: ko.observable("后台管理系统"),
	    				crumbs: ko.observableArray([]),
	    				user: app.getUser(),
	    				menus: menus,
	    				submenus: ko.observableArray(menus[0].menus.slice())
	    			};
	    			ko.applyBindings(vm, app("nav"));
	    			
	    			if(w.$router.current) {
	    				vm.title(w.$router.current.name);
	    				vm.crumbs(w.$router.current.mathes);
	    			}
	    			w.$router.watch(function(router) {
	    				vm.title(router.name);
	    				vm.crumbs(router.mathes);
	    			});
	    			
	    			var nav = $("#nav");
	    			var topNavMenu = $(".top-nav-menu", nav).on("click", "li", function(evt) {
	    				var $this = $(this);
	    				if($this.hasClass("selected")) {
	    					return;
	    				}
	    				
	    				$(".selected", topNavMenu).removeClass("selected");
	    				$this.addClass("selected");
	    				
	    				var index = Number($this.attr("index"));
	    				if(index > -1 && index < menus.length && menus[index].menus) {
	    					vm.submenus(menus[index].menus.slice());
	    				} else {
	    					vm.submenus.removeAll();
	    				}
	    			});
	    			var topSubMenu = $(".top-sub-menu", nav).on("click", "li", function(evt) {
	    				var $this = $(this);
	    				if($this.hasClass("selected")) {
	    					return;
	    				}
	    				
	    				$(".selected", topSubMenu).removeClass("selected");
	    				$this.addClass("selected");
	    			});
	    			
	    			$("#logout").click(function() {
	    				app.clearUser();
	    				app.path("login.html");
	    			});
	    		})(window, jQuery, ko, App);
	    </script>
	</body>
</html>
